<!DOCTYPE html>
<html>
<head>

  <meta charset="utf-8">
  
  
  <title>用 Cloudflare Workers 和 Durable Objects 搭建一个极简文本聊天室 | 我爱白嫖</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="google-adsense-account" content="ca-pub-5400876400049616">
  <meta name="description" content="用 Cloudflare Workers 和 Durable Objects 搭建一个极简文本聊天室。">
<meta property="og:type" content="article">
<meta property="og:title" content="用 Cloudflare Workers 和 Durable Objects 搭建一个极简文本聊天室">
<meta property="og:url" content="https://waiyiyuyan.github.io/2025/12/08/cloudflare-chatroom/index.html">
<meta property="og:site_name" content="我爱白嫖">
<meta property="og:description" content="用 Cloudflare Workers 和 Durable Objects 搭建一个极简文本聊天室。">
<meta property="og:locale">
<meta property="article:published_time" content="2025-12-08T13:18:59.000Z">
<meta property="article:modified_time" content="2025-12-09T05:34:14.318Z">
<meta property="article:author" content="waiyiyuyan">
<meta property="article:tag" content="vpn,免费vpn,科学上网,网络代理,隐私保护,梯子">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="我爱白嫖" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">


  <meta name="google-site-verification" content="aH851F92gNj2VQSV3o4uDaXBVIwNG1q5aHBKeBlBceQ" />
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5400876400049616"
     crossorigin="anonymous"></script>
     
<meta name="generator" content="Hexo 7.3.0"></head>

<body>

<!-- 展示广告 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5400876400049616"
     data-ad-slot="4680496511"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">我爱白嫖</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">vpn</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Suche"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://waiyiyuyan.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-cloudflare-chatroom" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/12/08/cloudflare-chatroom/" class="article-date">
  <time class="dt-published" datetime="2025-12-08T13:18:59.000Z" itemprop="datePublished">2025-12-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      用 Cloudflare Workers 和 Durable Objects 搭建一个极简文本聊天室
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>想快速拥有一个搭建一个极简文本聊天室吗？<br>传统服务器运维复杂，而 Cloudflare Workers 提供的无服务架构，是搭建这种<strong>轻量级、安全、低延迟</strong>文本聊天室的完美选择。</p>
<span id="more"></span>
<p><strong>我们的定位：这是一个为团队或小圈子设计的“极简电报机”——它专注文本即时通讯，舍弃了多媒体和复杂通话功能，以追求极致的简单、稳定和私密性。</strong></p>
<h2 id="🎯-聊天程序定位：极简与高效"><a href="#🎯-聊天程序定位：极简与高效" class="headerlink" title="🎯 聊天程序定位：极简与高效"></a>🎯 聊天程序定位：极简与高效</h2><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">定位描述</th>
<th align="left">技术优势</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>功能范围</strong></td>
<td align="left"><strong>纯文本</strong>即时消息。<strong>不支持</strong>图片、视频、文件传输、语音或视频通话。</td>
<td align="left">专注于 WebSocket 文本帧处理，数据量小，延迟最低。</td>
</tr>
<tr>
<td align="left"><strong>私密性</strong></td>
<td align="left"><strong>专属房间</strong>（Dedicated Private Rooms）。房间由用户自行命名，不公开列表。</td>
<td align="left">Durable Objects 的<strong>单例特性</strong>保证了房间状态的隔离和独立。</td>
</tr>
<tr>
<td align="left"><strong>性能</strong></td>
<td align="left"><strong>全球低延迟</strong>。适用于对响应速度要求高的文本交流场景。</td>
<td align="left">Workers 运行在 Cloudflare 边缘，靠近全球用户。</td>
</tr>
<tr>
<td align="left"><strong>架构</strong></td>
<td align="left"><strong>真正的无服务</strong>。无需关心服务器扩容和维护。</td>
<td align="left">自动处理高并发下的连接和状态管理。</td>
</tr>
</tbody></table>
<hr>
<h2 id="🛠️-核心技术重述：极简的秘密"><a href="#🛠️-核心技术重述：极简的秘密" class="headerlink" title="🛠️ 核心技术重述：极简的秘密"></a>🛠️ 核心技术重述：极简的秘密</h2><p>这个“极简电报机”之所以能高效运转，是因为依赖于以下三个核心技术：</p>
<ol>
<li><strong>Cloudflare Workers：</strong> 全球调度中心，负责快速调度请求。</li>
<li><strong>Durable Objects (DO)：</strong> 房间的唯一管理员。每个房间 ID 对应一个唯一的 DO 实例，确保了<strong>私密状态隔离</strong>和<strong>单例广播</strong>。</li>
<li><strong>WebSockets：</strong> 文本数据的专用通道，只用于传输轻量的 <strong>JSON 格式文本数据</strong>。</li>
</ol>
<hr>
<h2 id="🏗️-搭建步骤：部署你的专属电报机"><a href="#🏗️-搭建步骤：部署你的专属电报机" class="headerlink" title="🏗️ 搭建步骤：部署你的专属电报机"></a>🏗️ 搭建步骤：部署你的专属电报机</h2><p>搭建过程比你想象的要简单，我们利用官方提供的工具和模板，事半功倍。</p>
<h3 id="步骤-1-准备环境和工具-💻"><a href="#步骤-1-准备环境和工具-💻" class="headerlink" title="步骤 1: 准备环境和工具 💻"></a>步骤 1: 准备环境和工具 💻</h3><p>在开始之前，你需要准备好以下三个核心工具：<strong>Git</strong>（代码管理）、<strong>Node.js</strong>（运行环境）和 <strong>Wrangler CLI</strong>（部署工具）。</p>
<h4 id="A-安装-Git（版本控制系统）"><a href="#A-安装-Git（版本控制系统）" class="headerlink" title="A. 安装 Git（版本控制系统）"></a>A. 安装 Git（版本控制系统）</h4><p>Git 是我们用来<strong>克隆</strong>官方 Demo 项目仓库的必备工具。</p>
<ul>
<li><p><strong>官方下载地址：</strong> <a target="_blank" rel="noopener" href="https://git-scm.com/downloads"><strong>https://git-scm.com/downloads</strong></a></p>
</li>
<li><p><strong>安装方法：</strong> 访问上述官方网站，下载并运行适用于您操作系统的安装程序。</p>
</li>
<li><p><strong>验证安装：</strong> 运行 <code>git --version</code> 确认版本号。</p>
</li>
</ul>
<h4 id="B-安装-Node-js-推荐-v18"><a href="#B-安装-Node-js-推荐-v18" class="headerlink" title="B. 安装 Node.js (推荐 v18+)"></a>B. 安装 Node.js (推荐 v18+)</h4><p>Node.js 是运行 Worker 开发工具和 Wrangler CLI 所必需的环境。</p>
<ul>
<li><strong>安装方法：</strong> 访问 <strong>Node.js 官方网站</strong> (<a target="_blank" rel="noopener" href="https://nodejs.org/">https://nodejs.org/</a>)，下载并运行适用于您系统的 <strong>LTS (长期支持) 版本</strong>安装程序。安装程序会自带 <strong>npm</strong>（Node.js 包管理器）。</li>
<li><strong>验证安装：</strong> 运行 <code>node -v</code> 和 <code>npm -v</code> 确认版本号。</li>
</ul>
<h4 id="C-全局安装-Wrangler-CLI"><a href="#C-全局安装-Wrangler-CLI" class="headerlink" title="C. 全局安装 Wrangler CLI"></a>C. 全局安装 Wrangler CLI</h4><p><strong>Wrangler</strong> 是 Cloudflare 官方的命令行工具，用于将您的代码部署到 Cloudflare 边缘网络。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g wrangler</span><br></pre></td></tr></table></figure>

<h4 id="D-认证-Wrangler"><a href="#D-认证-Wrangler" class="headerlink" title="D. 认证 Wrangler"></a>D. 认证 Wrangler</h4><p>运行以下命令，并在浏览器中完成授权，以便 Wrangler 可以部署您的项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx wrangler login</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="步骤-2-获取并配置项目代码"><a href="#步骤-2-获取并配置项目代码" class="headerlink" title="步骤 2: 获取并配置项目代码"></a>步骤 2: 获取并配置项目代码</h3><p>使用 Git 克隆 Cloudflare 官方的 Demo 项目，并进入项目目录安装依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/cloudflare/workers-chat-demo.git</span><br><span class="line"><span class="built_in">cd</span> workers-chat-demo</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>
<p>如果克隆失败 运行这行命令 ，开启代理，我的端口是 10808 所以我写 10808 ，你根据自己的的 vpn 代理端口填写</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy http://127.0.0.1:10808</span><br></pre></td></tr></table></figure>
<h4 id="配置示例：wrangler-toml-🔑"><a href="#配置示例：wrangler-toml-🔑" class="headerlink" title="配置示例：wrangler.toml 🔑"></a>配置示例：<code>wrangler.toml</code> 🔑</h4><p>这是项目的默认配置文件，它<strong>确保 Durable Object 绑定正确</strong>，是我们实现聊天室功能的基础。</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name</span> = <span class="string">&quot;edge-chat-demo&quot;</span></span><br><span class="line"><span class="attr">compatibility_date</span> = <span class="string">&quot;2024-01-01&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">main</span> = <span class="string">&quot;src/chat.mjs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[durable_objects]</span></span><br><span class="line"><span class="attr">bindings</span> = [</span><br><span class="line">  &#123; name = <span class="string">&quot;rooms&quot;</span>, class_name = <span class="string">&quot;ChatRoom&quot;</span> &#125;,</span><br><span class="line">  &#123; name = <span class="string">&quot;limiters&quot;</span>, class_name = <span class="string">&quot;RateLimiter&quot;</span> &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="section">[[rules]]</span></span><br><span class="line"><span class="attr">type</span> = <span class="string">&quot;Data&quot;</span></span><br><span class="line"><span class="attr">globs</span> = [<span class="string">&quot;**/*.html&quot;</span>]</span><br><span class="line"><span class="attr">fallthrough</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Indicate that you want the ChatRoom and RateLimiter classes to be callable as Durable Objects.</span></span><br><span class="line"><span class="section">[[migrations]]</span></span><br><span class="line"><span class="attr">tag</span> = <span class="string">&quot;v1&quot;</span>                                          <span class="comment"># Should be unique for each entry</span></span><br><span class="line"><span class="attr">new_sqlite_classes</span> = [<span class="string">&quot;ChatRoom&quot;</span>, <span class="string">&quot;RateLimiter&quot;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>配置解析：</strong></p>
<ol>
<li><strong><code>main = &quot;src/chat.mjs&quot;</code>:</strong> 指定 Workers 的入口代码文件。</li>
<li><strong><code>[durable_objects].bindings</code>:</strong> 关键部分！它将 Worker 代码中的变量名（如 <code>rooms</code>）与实际的 Durable Object 类名（如 <code>ChatRoom</code>）关联起来。</li>
<li><strong><code>[[migrations]]</code>:</strong> 确保 <code>ChatRoom</code> 和 <code>RateLimiter</code> 在 Cloudflare 平台被正确注册为持久化对象，拥有独立的存储命名空间。</li>
</ol>
<hr>
<h3 id="步骤-3-核心代码逻辑（房主的工作流程）"><a href="#步骤-3-核心代码逻辑（房主的工作流程）" class="headerlink" title="步骤 3: 核心代码逻辑（房主的工作流程）"></a>步骤 3: 核心代码逻辑（房主的工作流程）</h3><p>您的 Worker 代码接收请求，并根据房间 ID，找到对应的 <strong><code>ChatRoom</code> Durable Object 实例</strong>（房主）。</p>
<ul>
<li><strong>房主的工作流程：</strong><ol>
<li><strong>连接处理：</strong> 房主接收 Worker 转发来的 WebSocket 连接。</li>
<li><strong>维护列表：</strong> 房主将这个 WebSocket 对象存入一个内部的连接列表。</li>
<li><strong>消息广播：</strong> 房主收到任何文本消息后，会<strong>遍历</strong>列表，将消息即时发送给房间内的所有其他客户端。</li>
</ol>
</li>
</ul>
<hr>
<h3 id="步骤-4-部署上线"><a href="#步骤-4-部署上线" class="headerlink" title="步骤 4: 部署上线"></a>步骤 4: 部署上线</h3><p>在部署到 Cloudflare 的全球网络之前，使用 wrangler dev 命令在本地进行实时测试和调试是至关重要的一步。</p>
<p>wrangler dev 会启动一个本地服务器，模拟 Worker 环境运行您的代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx wrangler dev</span><br></pre></td></tr></table></figure>

<p>一切就绪后，只需一行命令，您的<strong>极简文本聊天室</strong>就会被发布到 Cloudflare 的全球网络上：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx wrangler deploy</span><br></pre></td></tr></table></figure>

<p>部署完成后，你将获得一个 URL。访问它，你和你的伙伴就可以开始使用这个极简、高效且私密的文本聊天室了！</p>

        
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-5400876400049616"
     data-ad-slot="3064162511"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://waiyiyuyan.github.io/2025/12/08/cloudflare-chatroom/" data-id="cmix6lylc00009ktq4t6n0fm1" data-title="用 Cloudflare Workers 和 Durable Objects 搭建一个极简文本聊天室" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2025/12/09/befriend/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          白嫖机场——交个朋友
        
      </div>
    </a>
  
  
    <a href="/2025/12/06/ezyun/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">Ezyun EZ 云机场：限时福利！0 元抢 100GB 免费直连套餐！</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/vpn/">vpn</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%BA%E5%9C%BA/">机场</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%B8%E6%88%8F/">游戏</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B5%84%E6%BA%90%E5%AF%BC%E8%88%AA/">资源导航</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apple-ID/" rel="tag">Apple ID</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%B8%E6%88%8F%E4%B8%8B%E8%BD%BD/" rel="tag">游戏下载</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Apple-ID/" style="font-size: 10px;">Apple ID</a> <a href="/tags/%E6%B8%B8%E6%88%8F%E4%B8%8B%E8%BD%BD/" style="font-size: 10px;">游戏下载</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2026/01/">January 2026</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/12/">December 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/11/">November 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2026/01/01/fitgirl/">【深度测评】硬盘塞不下了？别只盯着 Byrutor，带你玩转全球最硬核的游戏资源站 FitGirl</a>
          </li>
        
          <li>
            <a href="/2025/12/31/lrt/">0元白嫖100G流量</a>
          </li>
        
          <li>
            <a href="/2025/12/28/baokemeng/">零元薅羊毛！宝可梦机场 60G 流量免费领</a>
          </li>
        
          <li>
            <a href="/2025/12/26/tuitui/">薅羊毛！注册即送 20GB 高速流量，解锁 ChatGPT/Gemini</a>
          </li>
        
          <li>
            <a href="/2025/12/23/ftclash/">注册即送 100GB/30天套餐</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2026 waiyiyuyan<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
<!-- 橱窗广告 -->
  
  <ins class="adsbygoogle"
      style="display:block"
      data-ad-format="autorelaxed"
      data-ad-client="ca-pub-5400876400049616"
      data-ad-slot="9222376757"></ins>
  <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</body>
</html>